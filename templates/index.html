
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>마스터시트 데이터 입력</title>
    <style>
        input[type=text] { width: 90px; }
        .title { font-weight: bold; padding-top: 10px; }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
    document.getElementById("excelFileInput").addEventListener("change", function (e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function (evt) {
            const data = new Uint8Array(evt.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            for (let i = 1; i < json.length; i++) {
                const row = json[i];
                const table = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
                const newRow = table.rows[0].cloneNode(true);
                const inputs = newRow.getElementsByTagName("input");
                for (let j = 0; j < inputs.length && j < row.length; j++) {
                    inputs[j].value = row[j];
                }
                table.appendChild(newRow);
            }
        };
        reader.readAsArrayBuffer(file);
    });
</script>

</head>

<body>
    <h2>📋 마스터시트 데이터 입력</h2>
    <form method="POST" action="/download_excel">
        <label>제품군:
            <select name="제품군">
                <option value="영상감시">영상감시</option>
                <option value="출입통제">출입통제</option>
            </select>
        </label><br><br>

        <table border="1" id="dataTable">
            <thead>
                <tr>
                    <th>구분</th><th>계약여부</th><th>식별번호</th><th>계약금액</th><th>제품모델명</th><th>품명</th><th>모델명</th>
                    <th>규격</th><th>수량</th><th>원산지</th><th>구성종류</th><th>제품원가</th><th>원천제조사</th><th>수익률</th><th>비고</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="text" name="구분"></td>
                    <td><input type="text" name="계약여부"></td>
                    <td><input type="text" name="식별번호"></td>
                    <td><input type="text" name="계약금액"></td>
                    <td><input type="text" name="제품모델명"></td>
                    <td><input type="text" name="품명"></td>
                    <td><input type="text" name="모델명"></td>
                    <td><input type="text" name="규격"></td>
                    <td><input type="text" name="수량"></td>
                    <td><input type="text" name="원산지"></td>
                    <td><input type="text" name="구성종류"></td>
                    <td><input type="text" name="제품원가"></td>
                    <td><input type="text" name="원천제조사"></td>
                    <td><input type="text" name="수익률"></td>
                    <td><input type="text" name="비고"></td>
                </tr>
            </tbody>
        </table>
        <br>
        <button type="button" onclick="addRow()">➕ 행 추가</button><br><br>

        <label class="title">업로드 메모:</label><br>
        <textarea name="업로드메모" rows="4" cols="100" placeholder="업로드에 대한 설명 또는 특이사항을 입력해 주세요."></textarea><br><br>

        
    <label class="title">엑셀 파일 업로드:</label><br>
    <input type="file" id="excelFileInput" accept=".xlsx"><br><br>
    <input type="submit" value="📥 엑셀로 다운로드">

    </form>

    <script>
        function addRow() {
            const table = document.getElementById("dataTable").getElementsByTagName('tbody')[0];
            const newRow = table.rows[0].cloneNode(true);
            const inputs = newRow.getElementsByTagName("input");
            for (let i = 0; i < inputs.length; i++) inputs[i].value = "";
            table.appendChild(newRow);
        }
    
    document.getElementById("excelFileInput").addEventListener("change", function (e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = function (evt) {
            const data = new Uint8Array(evt.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            for (let i = 1; i < json.length; i++) {
                const row = json[i];
                const table = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
                const newRow = table.rows[0].cloneNode(true);
                const inputs = newRow.getElementsByTagName("input");
                for (let j = 0; j < inputs.length && j < row.length; j++) {
                    inputs[j].value = row[j];
                }
                table.appendChild(newRow);
            }
        };
        reader.readAsArrayBuffer(file);
    });
</script>

</body>
</html>
